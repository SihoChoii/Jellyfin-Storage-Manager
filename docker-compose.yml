# JellyMover full-stack stack
#   docker compose up --build
#   Visit http://localhost:3000/ for the SPA or /health for backend status
# /media/hot <-> ./test-media/hot, /media/cold <-> ./test-media/cold
#
# CORS Testing (after starting the container):
# Test that private IPs are allowed:
#   curl -H "Origin: http://localhost:3000" -I http://localhost:3000/api/config
#   curl -H "Origin: http://192.168.1.50:3000" -I http://localhost:3000/api/config
#   curl -H "Origin: http://10.0.0.100:3000" -I http://localhost:3000/api/config
# Test that public domains are blocked (should NOT have Access-Control-Allow-Origin):
#   curl -H "Origin: http://evil.com" -I http://localhost:3000/api/config
#
# Look for "Access-Control-Allow-Origin" header in successful responses

services:
  jellymover-backend:
    # For local development:
    build:
      context: .
      dockerfile: Dockerfile
    # For TrueNAS SCALE / registry deployments, use this image instead:
    # image: ghcr.io/SihoChoii/jellymover:latest
    image: jellymover-app
    container_name: jellymover
    ports:
      - "3000:3000"
    environment:
      JM_PORT: "3000"
      JM_CONFIG_PATH: /config/app-config.json
      JM_DB_PATH: /data/jellymover.db
      JM_LOG_LEVEL: info
    volumes:
      - ./config:/config
      - ./data:/data
      - ./test-media/hot:/media/hot
      - ./test-media/cold:/media/cold
